{"_id":"_design/migrations-add-uuid-to-scheduled-tasks","views":{"scheduled-tasks-no-uuids":{"map":"function (doc) {\n  var now = new Date(),\n      match = false;\n  //var now = new Date('2017-01-06T12:00:00.000Z');\n  if (doc &&\n      doc.type === 'data_record' &&\n      doc.form &&\n      doc.scheduled_tasks) {\n    doc.scheduled_tasks.forEach(function(task) {\n      if (now.valueOf() < new Date(task.due).valueOf()) {\n        //log(\"now is \" + now.valueOf());\n        //log(\"task.due is \" + new Date(task.due).valueOf());\n        task.messages.forEach(function(msg) {\n          if (!msg.uuid) {\n            match = true;\n          }\n        });\n      }\n    });\n  }\n  if (match) {\n    emit();\n  }\n}"}}}
